@using System.Net
@{
    ViewData["Title"] = "Chuyển khoản VietQR";
    var idTable = ViewData["IdTable"]?.ToString() ?? "";
    var restaurantId = ViewData["RestaurantId"]?.ToString() ?? "";
    var paymentInfo = ViewData["PaymentInfo"] as PaymentInfo;
    var amount = ViewData["Amount"] != null ? Convert.ToDecimal(ViewData["Amount"]) : 0m;
    var description = ViewData["Description"]?.ToString() ?? "";
    var accountName = ViewData["AccountName"]?.ToString() ?? "";
    var accountNumber = ViewData["AccountNumber"]?.ToString() ?? "";
    var bank = ViewData["Bank"]?.ToString() ?? "";
    var encodedDescription = WebUtility.UrlEncode(description);
    var encodedAccountName = WebUtility.UrlEncode(accountName);
}
@if (string.IsNullOrEmpty(idTable) || string.IsNullOrEmpty(restaurantId))
{
    <div class="alert alert-danger mt-5">Không hợp lệ!</div>
}
else
{
    <div class="container mt-5" style="max-width: 500px;">
        <div class="card shadow">
            <div class="card-body text-center">
                <h3 class="mb-3 fw-bold">Chuyển khoản VietQR</h3>
                <div class="mb-3">
                    <img src="https://img.vietqr.io/image/MB-@accountNumber-compact2.png" alt="VietQR" class="img-fluid"
                        style="max-width: 300px;"
                        onerror="this.onerror=null;this.src='https://img.vietqr.io/image/VCB-123456789-compact2.png?amount=100000&addInfo=Demo';" />
                </div>
                <p class="fw-bold" style="font-size: 20px;">Vui lòng chuyển khoản theo thông tin sau:</p>
                <div class="d-flex flex-column" style="gap: 0">
                    <p style="margin-bottom: 1px;">Ngân hàng: @paymentInfo?.Bank</p>
                    <p style="margin-bottom: 1px;">Số tài khoản: @paymentInfo?.AccountNumber</p>
                    <p style="margin-bottom: 1px;">Tên tài khoản: @paymentInfo?.AccountName</p>
                    <p style="margin-bottom: 1px;">Số tiền: @ViewData["Amount"] VNĐ</p>
                    <p style="margin-bottom: 1px;">Nội dung chuyển khoản: @ViewData["Description"]</p>
                </div>


                <div class="action-field d-flex flex-column gap-3">
                    <a href="@Url.Action("CartDetail", "Cart", new { acsc = Context.Request.Query["acsc"] })"
                        class="btn btn-secondary mt-3">Quay lại giỏ hàng</a>
                    <form asp-controller="Payment" asp-action="Create" method="post">
                        <input type="hidden" name="acsc" value="@Context.Request.Query["acsc"]" />
                        <button type="submit" class="btn btn-success">Đã thanh toán</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
}